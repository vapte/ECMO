#pragma rtGlobals=1		// Use modern global access method.Function CalcSat(pp,Hill,p50,maxSat)	//given partial pressure of O2	variable pp,hill,p50,maxSat		return ((maxSat*pp^Hill)/((p50^hill)+(pp^hill)) )EndFunction CalcContent(pp,Hill,p50,MaxSat,Hb)			//per dl	variable pp,hill,p50,maxSat,Hb		variable Sat= CalcSat(pp,Hill,p50,maxSat)	return ((Hb*(Sat/100)*1.34)+(pp*0.003))EndFunction ConvertSat2Color(sat)	variable sat		return (5 + (sat*20/100))End//**********  VQ procedures ******//First, given SVO2, calculate impact of VV ECMO on PA sat.  This is basically looking at an admixture of flow through the ECMO (base) mixed with a shunt of the remaining cardiac output (apex + middle - base)Function Admixture(s1,p1,v1,s2,p2,v2)			//given two volumes, v1, v2, with sats and po2, return sat, s3, of admixture, v3	variable s1,p1,v1,s2,p2,v2		variable c1,c2,c3,v3, p3,s3	nvar Hill=Hill, p50=p50, MaxSat=MaxSat, GVHb=GVHb		C1=  CalcContent(p1,Hill,p50,MaxSat,GVHb)	C2= CalcContent(P2,Hill,p50,MaxSat,GVHb)		V3=V1+V2	C3=((C1*V1)+(C2*V2))/V3		wave HbcontentCurve=HbcontentCurve,HbCurve=HbCurve	HbcontentCurve=CalcContent(p,Hill,p50,MaxSat,GVHb)	FindLevel/q HbcontentCurve, c3				//this finds the pO2 of the admixture	p3=V_levelX		HbCurve= CalcSat(p,Hill,p50,maxSat)	s3=HbCurve[p3];					if (v1==0)		s3=s2	endif	if (v2==0)		s3=s1	endif	//color= ConvertSat2Color(sats[p])	//ModifyGraph zColor(Vols)={color,0,50,BlueRedGreen256}		return s3endFunction FindSVO2(metab,artsat,artpO2,flow,hb)	variable metab,artsat,artpO2,flow,hb			 variable del=((Hb*(artSat/100)*1.34)+(artPO2*0.003))*flow*10	 variable vcontent=del-metab	 variable vpcent=Vcontent/(Hb*1.34*flow*10)	 	 	 //print del,vcontent	 	 return max(0, (vpcent*100))	 	 End					Function OLDUpdate()	wave artery=artery,vein=vein,alveoli=alveoli,alveioli2=alveoli2	wave arterycolor=arterycolor,veincolor=veincolor	wave HbNormal=HbNormal		nvar bloodbase=bloodbase,bloodmiddle=bloodmiddle,bloodapex=bloodapex	nvar ventbase=ventbase,ventmiddle=ventmiddle,ventapex=ventapex		nvar SatApex=SatApex,SatMiddle=SatMiddle,SatBase=SatBase	nvar pO2Apex=pO2Apex,pO2Middle=pO2Middle,pO2Base=pO2Base		nvar FIO2=FIO2,ECMOFIO2=ECMOFIO2,SVO2=SVO2,MVO2=MVO2,Hb=Hb, PAsat=PAsat, PAPO2=PAPO2	nvar totalflow=totalflow, heartflow=heartflow, VVECMOflow=VVECMOflow, VAECMOflow=VAECMOflow,PercentVforBlendedECMO=PercentVforBlendedECMO	nvar satPulmVein=SatPulmVein, pO2PulmVein=pO2PulmVein, SysPO2=SysPO2, SysSat=SysSat, SVPO2=SVPO2		nvar SF=SF					BloodApex=HeartFlow*(1-SF)	BloodMiddle=HeartFlow*SF			SVO2=FindSVO2OLD(MVO2)	SVPO2=ConvertSat2PO2(SVO2)		ChangeGroupBoxColor("groupsystemvenous",SVO2)		ChangeGroupBoxColor("grouplowerIVC",SVO2)		ChangeGroupBoxColor("groupSysV",SVO2)			//ECMO  satbase will be output of ECMO that mixes with rest of lung flow-admixture is PA sat			variable maxpo2,maxsat		maxPO2=ReturnEquilibriumPO2(ECMOFIO2,VentBase,(Sat2PO2(SVO2)),BloodBase)		maxsat=Hbnormal[maxPO2]			//need to check that the calculated flux by the above method does not exceed the company specs for maximum ECMO flux			variable CalcFlux=CalcBloodContent(maxsat,Hb,(bloodBase*10)) - CalcBloodContent(SVO2,Hb,(bloodBase*10))	variable MaxFlux=ECMOflux(BloodBase,(760-(sat2po2(SVO2))))			//print CalcFlux,MaxFlux	if (CalcFlux<MaxFlux)		po2base=maxPO2		SatBase=maxSat				else  //add MaxFlux to venous content 		variable Vcontent= CalcBloodContent(SVO2,Hb,(bloodBase*10)) + MaxFlux	//print Vcontent		po2base= CalcPO2fromContent(Vcontent,Hb,(bloodbase*10))		satbase=Hbnormal[PO2base]			endif		nvar ECMOefficiency=ECMOefficiency		ECMOefficiency=min(1,(MaxFlux/CalcFlux))										//now calculate change in pCO2 in the ECMO effluent									// takes co2 in systemic venous volume going through ECMO, equilibrate pCO2 with ECMO sweep volume, calculate CO2 flux// Now calculte PA sat--portion of ECMO flow that is returned to venous system will mix with remaining cardiac output.		VVECMOflow=PercentVforBlendedECMO*bloodbase/100	heartflow=bloodapex+bloodmiddle		if (heartflow<=VVECMOflow)				bloodbase-=1		VVECMOflow=PercentVforBlendedECMO*bloodbase/100		print "flow through lungs less than VV ecmo!!"			endif		VAECMOflow=(100-PercentVforBlendedECMO)*bloodbase/100	totalflow=heartflow+VAECMOflow			PASAT=Admixture(satBase,pO2base,VVECMOflow,SVO2,(sat2PO2(SVO2)),(heartflow-VVECMOflow))	PAPO2=sat2PO2(PASAT)		ChangeGroupBoxColor("groupUpperIVC2",PASAT)		ChangeGroupBoxColor("groupPulmArt",PASAT)		ChangeGroupBoxColor("groupLungA",PASAT)		ChangeGroupBoxColor("groupShunt",PASAT)										//calculate PCO2 content in venous blood		//GOOD LUNG		po2apex=ReturnEquilibriumPO2(FIO2,VentApex,PAPO2,BloodApex)	//print FIO2,VentApex,PAPO2,BloodApex	Satapex=HbNormal[po2apex]				ChangeGroupBoxColor("groupLungV",SatApex)			//SHUNT		po2middle=ReturnEquilibriumPO2(FIO2,VentMiddle,(Sat2PO2(PASAT)),BloodMiddle)	Satmiddle=HbNormal[po2middle]				//veincolor[1]=Convertsat2color2(satMiddle)			//now, combine the good lung and shunt to give the pulm vein admixture			SatPulmVein=Admixture(satApex,pO2Apex,BloodApex,PASAT,(sat2PO2(PASAT)),bloodMiddle)		Po2PulmVein=Sat2PO2(SatPulmVein)			ChangeGroupBoxColor("groupPulmVein",SatPulmVein)			ChangeGroupBoxColor("groupAorticArch",SatPulmVein)				//now, combine the pulm vein and the VAecmo flow for the systemic admixture		SysSat=Admixture(satpulmVein,Po2PulmVein,heartflow,SatBase,pO2Base,VAECMOflow)		SysPO2=Sat2PO2(SysSat)		ChangeGroupBoxColor("groupFemoralA",SysSat)		ChangeGroupBoxColor("groupSystemArt",SysSat)		ChangeGroupBoxColor("groupSysA",SysSat)		EndFunction ChangeGroupBoxColor(gbname,sat)	string gbname	variable sat			variable s=sat		if (sat<40)			s=40		endif				variable a=(1000*(s-35))		variable b=(50-(s/2))*1000								//variable a=(667*sat)		//variable b=(100-sat)*500						GroupBox $gbname labelback=(a,0,b)EndFunction Sat2PO2(sat)	variable sat	wave HbNormal=HbNormal	FindLevel/q HbNormal Sat	if (V_flag)		return (760)	else		return V_levelX	endifEndFunction CalcBloodContent(sat,Hb,vol)			//vol in dl	variable Sat,Hb,vol		variable po2=Sat2PO2(sat)	return (  ((Hb*(Sat/100)*1.34)+(pO2*0.003)) * vol)  //in mlEndFunction CalcBloodContentfromPO2(PO2,Hb,vol)			//vol in dl	variable PO2,Hb,vol		wave HbNormal=HbNormal	variable Sat=Hbnormal[PO2]	return (  ((Hb*(Sat/100)*1.34)+(pO2*0.003)) * vol)  //in mlEndFunction CalcPO2fromContent(content,Hb,vol)		//vol in dl	variable content, Hb,vol	wave HbcontentCurve=HbcontentCurve		HbcontentCurve=CalcBloodContentfromPO2(p,Hb,vol)	FindLevel/q HbcontentCurve, content	return V_levelXendFunction CalcGasContent(po2,vol)	variable po2,vol		return (vol*pO2/760)			//in mlEndFunction MakeGasCurve(pO2,vol)	variable pO2,vol	make/o/n=(760) GasCurve	GasCurve=p*vol/760EndFunction MakeBloodCurve(pO2,vol)	variable pO2,vol	wave HbNormal=HbNormal	variable sat=HbNormal[pO2]	nvar Hb=Hb		make/o/n=760 bloodcurve		bloodcurve=((Hb*(HbNormal[p]/100)*1.34)+(p*0.003)) * vol/100	endEndFunction ReturnEquilibriumPO2(FIO2,Vgas,Pblood,Vblood)			//blood and gas into an oxygenator, output pO2	variable FIO2,Vgas,Pblood,Vblood	variable pO2		MakeGasCurve((FIO2*(760-47)),Vgas*1000)		wave GasCurve=GasCurve			if (Vblood==0)		pO2=FIO2*(760-47)	else					MakeBloodCurve(Pblood,Vblood*1000)		wave bloodcurve=bloodcurve				pO2=FindEquilibriumPO2(gascurve,bloodcurve, FIO2*(760-47), Pblood)	Endif		return (pO2)EndFunction FindEquilibriumPO2(gascurve,bloodcurve,gasPO2,BloodPO2)	wave gascurve,bloodcurve	variable gasPO2,BloodPO2		variable gascontent=gascurve[GasPO2], bloodcontent=bloodcurve[BloodPO2]	variable increment=0.1,count=0				//print gasPO2,bloodpo2	if (GasPO2>BloodPO2)	do		bloodcontent+=increment		gascontent-=increment				Findlevel/q bloodcurve bloodcontent			BloodPO2=V_levelX		Findlevel/q gascurve gascontent			GasPO2=V_levelX		count+=1	while ((GasPO2-BloodPO2)>0)				//print GasPO2,BloodPO2,Count	Return (BloodPO2)		endifENDfunction FindSVO2OLD(mvo2)	variable mvo2		nvar syssat=syssat, sysPO2=sysPO2, totalflow=totalflow, Hb=Hb		 variable del=((Hb*(sysSat/100)*1.34)+(sysPO2*0.003))*totalflow*10	 variable vcontent=del-mvo2	 variable vpcent=Vcontent/(Hb*1.34*totalflow*10)	 	 	 //print del,vcontent	 	 return max(0, (vpcent*100))	 	 EndWindow VQgraph() : Graph	PauseUpdate; Silent 1		// building window...	Display /host=# artery,vein,alveoli,alveoli2 vs Position	ModifyGraph margin(left)=108,width=360,height=280,gbRGB=(65535,61210,59645)	ModifyGraph marker(alveoli)=19	ModifyGraph rgb(alveoli)=(52428,52425,1),rgb(alveoli2)=(52428,52425,1)	ModifyGraph msize(alveoli)=20	ModifyGraph toMode(artery)=-1,toMode(alveoli)=1,toMode(alveoli2)=-1	ModifyGraph useMrkStrokeRGB(alveoli)=1	ModifyGraph zmrkSize(alveoli)={alveolisize,0,1,1,6}	ModifyGraph zColor(artery)={arterycolor,0,50,BlueRedGreen256},zColor(vein)={veincolor,0,50,BlueRedGreen256}	ModifyGraph grid(bottom)=1	ModifyGraph noLabel(left)=2	ModifyGraph lblMargin(left)=63	ModifyGraph lblLatPos(left)=-2	ModifyGraph lblRot(bottom)=-90	ModifyGraph tkLblRot(bottom)=90	Label left "\\F'Comic Sans MS'\\Z12Liters/minute"	SetAxis left -5.5,5.5	TextBox/N=text2/F=0/A=MB/X=-0.71/Y=-9.17 "\\F'Comic Sans MS'\\Z12Flow (Liters/minute)"	Legend/N=text3/J/F=0/A=MB/X=0.71/Y=-23.33 "\\F'Comic Sans MS'\\Z12\\s(alveoli) Ventilation\r\\s(artery) Perfusion"	ModifyGraph swapXY=1EndFunction SetVarProcBlendECMOprecent(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		nvar VAECMOflow=VAECMOflow, VVECMOflow=VVECMOflow, bloodbase=bloodbase, heartflow=heartflow, totalflow=totalflow				Update()	Update()		EndFunction SetVarProcSVO2(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		wave arterycolor=arterycolor		arterycolor=( 25 - (.7*(100 - varNum)))	Update()	Update()		EndFunction SetVarProcFIO2(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varNameUpdate();Update()EndFunction SetVarProcHb(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Update();Update()EndFunction SliderProcVentApex(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	if(event %& 0x1)	// bit 0, value set	endif		nvar ventapex=ventapex		wave alveoli=alveoli,alveoli2=alveoli2		alveoli[2]=VentApex		alveoli2[2]=-VentApex	Update();Update()	return 0EndFunction SliderProcVentbase(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	if(event %& 0x1)	// bit 0, value set	endif		nvar ventbase=ventbase		wave alveoli=alveoli,alveoli2=alveoli2		alveoli[0]=Ventbase		alveoli2[0]=-Ventbase	Update();Update()	return 0EndFunction SliderProcVentmiddle(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	if(event %& 0x1)	// bit 0, value set	endif		nvar ventmiddle=ventmiddle		wave alveoli=alveoli,alveoli2=alveoli2		alveoli[1]=Ventmiddle		alveoli2[1]=-Ventmiddle	Update();Update()	return 0EndFunction SliderProcBloodapex(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	if(event %& 0x1)	// bit 0, value set	endif		nvar bloodapex=bloodapex	wave artery=artery,vein=vein		artery[2]=-bloodapex		vein[2]=bloodapex	Update();Update()	return 0EndFunction SliderProcBloodmiddle(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	if(event %& 0x1)	// bit 0, value set	endif		nvar bloodmiddle=bloodmiddle		wave artery=artery,vein=vein		artery[1]=-bloodmiddle		vein[1]=bloodmiddle	Update();Update()	return 0EndFunction SliderProcBloodbase(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	if(event %& 0x1)	// bit 0, value set	endif		nvar bloodbase=bloodbase		wave artery=artery,vein=vein		artery[0]=-bloodbase		vein[0]=bloodbase	Update();Update()	return 0EndFunction ConvertSat2Color2(sat)	variable sat		//return ( (sat/4))	return  ( 25 - (.7*(100 - sat)))EndWindow ecmo() : Panel	PauseUpdate; Silent 1		// building window...	NewPanel /W=(278,78,1379,714)	ShowInfo/W=ecmo	SetDrawLayer UserBack	SetDrawEnv linethick= 10,linefgc= (29524,1,58982),arrow= 1,arrowfat= 3	DrawLine 470,498,597,394	SetDrawEnv linethick= 10,linefgc= (65535,0,0),arrow= 1,arrowfat= 3	DrawLine 759,304,992,304	SetDrawEnv linethick= 10,linefgc= (65535,0,0),arrow= 1,arrowfat= 3	DrawLine 596,302,447,301	SetDrawEnv fsize= 18	DrawText 63,471,"V"	SetDrawEnv fsize= 18	DrawText 178,472,"A"	DrawText 104,476,"output"	SetDrawEnv textrot= 90	DrawText 214,451,"sweep"	Slider sliderVentBase,pos={228,403},size={53,167},proc=SliderProcVentbase	Slider sliderVentBase,limits={0,5,0.5},variable= ventBase,thumbColor= (65535,65533,32768)	GroupBox groupApex,pos={36,25},size={246,133},title="Ventilator"	GroupBox groupApex,font="Comic Sans MS",fSize=14,frame=0	GroupBox groupBase,pos={36,374},size={246,220},title="ECMO",font="Comic Sans MS"	GroupBox groupBase,fSize=12,frame=0	SetVariable setvarFIO2,pos={70,62},size={111,19},proc=SetVarProcFIO2,title="FIO2"	SetVariable setvarFIO2,font="Comic Sans MS",fSize=12	SetVariable setvarFIO2,limits={0.01,1,0.01},value= FIO2	SetVariable setvarMVO2,pos={626,545},size={88,19},proc=SetVarProcSVO2,title="MVO2"	SetVariable setvarMVO2,font="Comic Sans MS",fSize=12	SetVariable setvarMVO2,limits={100,500,10},value= mvo2,live= 1	SetVariable setvarHb,pos={172,254},size={71,19},proc=SetVarProcHb,title="Hb"	SetVariable setvarHb,font="Comic Sans MS",fSize=12,limits={0,20,1},value= Hb	GroupBox groupApex1,pos={601,18},size={151,107},title="Lung"	GroupBox groupApex1,font="Comic Sans MS",fSize=18	GroupBox groupMiddle1,pos={501,128},size={109,20},title="Shunt"	GroupBox groupMiddle1,font="Comic Sans MS",fSize=12	GroupBox groupBase1,pos={603,251},size={151,176},title="ECMO"	GroupBox groupBase1,font="Comic Sans MS",fSize=18	ValDisplay valdispPO2Apex,pos={639,82},size={63,17},title="pO2"	ValDisplay valdispPO2Apex,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispPO2Apex,limits={0,0,0},barmisc={0,1000},value= #"PO2Apex"	ValDisplay valdispPO2Base,pos={644,315},size={62,17},title="pO2"	ValDisplay valdispPO2Base,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispPO2Base,limits={0,0,0},barmisc={0,1000},value= #"PO2Base"	ValDisplay valdispSatBase,pos={643,353},size={62,17},title="Sat"	ValDisplay valdispSatBase,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispSatBase,limits={0,0,0},barmisc={0,1000},value= #"SatBase"	ValDisplay valdispSatApex,pos={640,58},size={58,17},title="Sat"	ValDisplay valdispSatApex,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispSatApex,limits={0,0,0},barmisc={0,1000},value= #"SatApex"	GroupBox groupPulmVein,pos={888,1},size={163,184},title="Pulm Vein"	GroupBox groupPulmVein,labelBack=(62954,0,1022),font="Comic Sans MS",fSize=16	ValDisplay valdispPulmVeinSat,pos={940,111},size={68,24},title="Sat"	ValDisplay valdispPulmVeinSat,font="Comic Sans MS",fSize=16,format="%0.f"	ValDisplay valdispPulmVeinSat,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispPulmVeinSat,value= #"SatPulmVein"	SetVariable setvarECMOFIO2,pos={66,552},size={123,19},proc=SetVarProcFIO2,title="ECMO FIO2"	SetVariable setvarECMOFIO2,font="Comic Sans MS",fSize=12	SetVariable setvarECMOFIO2,limits={0.01,1,0.01},value= ECMOFIO2	GroupBox groupSystemArt,pos={888,396},size={167,188},title="Systemic"	GroupBox groupSystemArt,labelBack=(62954,0,1022),font="Comic Sans MS",fSize=16	ValDisplay valdispSystemicSat,pos={927,511},size={96,34},title="Sat"	ValDisplay valdispSystemicSat,font="Comic Sans MS",fSize=24,format="%0.f"	ValDisplay valdispSystemicSat,limits={0,0,0},barmisc={0,1000},value= #"SysSat"	ValDisplay valdisptotalflow,pos={605,582},size={137,25},title="Total Flow"	ValDisplay valdisptotalflow,fSize=18,format="%.1f"	ValDisplay valdisptotalflow,limits={0,0,0},barmisc={0,1000},value= #"totalflow"	ValDisplay valdispCalcSVO4,pos={1594,264},size={96,13},title="PA sat"	ValDisplay valdispCalcSVO4,format="%0.f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCalcSVO4,value= #"PAsat"	GroupBox groupSystemVenous,pos={303,394},size={167,188},title="Venous"	GroupBox groupSystemVenous,labelBack=(44769,0,10115),font="Comic Sans MS"	GroupBox groupSystemVenous,fSize=16	ValDisplay valdispSVO2,pos={329,484},size={124,33},title="SVO2",fSize=24	ValDisplay valdispSVO2,format="%.0f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdispSVO2,value= #"SVO2"	GroupBox groupPulmArt,pos={304,2},size={164,184},title="Pulm Artery"	GroupBox groupPulmArt,labelBack=(44769,0,10115),font="Comic Sans MS",fSize=16	ValDisplay valdispCalcSVO2,pos={347,106},size={96,25},title="PA sat",fSize=18	ValDisplay valdispCalcSVO2,format="%0.f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCalcSVO2,value= #"PAsat"	SetVariable setvarMinuteVent,pos={72,101},size={161,19},proc=SetVarProcFIO2,title="Ventilation (L/min)"	SetVariable setvarMinuteVent,font="Comic Sans MS",fSize=12	SetVariable setvarMinuteVent,limits={1,10,0.5},value= ventApex	GroupBox groupPatient,pos={36,198},size={246,149},title="Patient"	GroupBox groupPatient,font="Comic Sans MS",fSize=14,frame=0	SetVariable setvarCO,pos={81,225},size={161,19},proc=SetVarProcFIO2,title="Cardiac Output"	SetVariable setvarCO,font="Comic Sans MS",fSize=12	SetVariable setvarCO,limits={1,10,0.5},value= heartflow	SetVariable setvarMVO3,pos={153,283},size={88,19},proc=SetVarProcSVO2,title="MVO2"	SetVariable setvarMVO3,font="Comic Sans MS",fSize=12	SetVariable setvarMVO3,limits={100,500,10},value= mvo2,live= 1	SetVariable setvarSF,pos={64,310},size={179,19},proc=SetVarProcSVO2,title="Lung Shunt Fraction"	SetVariable setvarSF,font="Comic Sans MS",fSize=12	SetVariable setvarSF,limits={0,1,0.05},value= SF,live= 1	Slider sliderAVblendECMO,pos={80,454},size={89,13},proc=SliderProc	Slider sliderAVblendECMO,limits={100,0,10},variable= PercentVforblendedECMO,side= 0,vert= 0	SetVariable setvarECMOFLOW,pos={71,410},size={109,19},proc=SetVarProcFIO2,title="Flow"	SetVariable setvarECMOFLOW,font="Comic Sans MS",fSize=12	SetVariable setvarECMOFLOW,limits={0,5,0.5},value= BloodBase	ValDisplay valdisVV,pos={497,277},size={71,17},title="V Flow"	ValDisplay valdisVV,font="Comic Sans MS",fSize=12,format="%.1f"	ValDisplay valdisVV,limits={0,0,0},barmisc={0,1000},value= #"VVECMOflow"	ValDisplay valdisVA,pos={829,277},size={72,17},title="A Flow"	ValDisplay valdisVA,font="Comic Sans MS",fSize=12,format="%.1f"	ValDisplay valdisVA,limits={0,0,0},barmisc={0,1000},value= #"VAECMOflow"	GroupBox groupLowerIVC,pos={411,307},size={34,108},title="\\Z06"	GroupBox groupLowerIVC,labelBack=(44769,0,10115),font="Comic Sans MS",fSize=5	GroupBox groupLowerIVC,frame=0	GroupBox groupUpperIVC,pos={408,188},size={34,108},labelBack=(65238,0,0)	GroupBox groupUpperIVC,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupAorticArch,pos={996,188},size={34,117},labelBack=(62954,0,1022)	GroupBox groupAorticArch,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupUpperIVC3,pos={1231,171},size={34,108},labelBack=(65238,0,0)	GroupBox groupUpperIVC3,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupFemoralA,pos={996,309},size={34,108},labelBack=(62954,0,1022)	GroupBox groupFemoralA,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupShunt,pos={473,150},size={411,16},labelBack=(44769,0,10115)	GroupBox groupShunt,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupLungA,pos={471,62},size={129,32},labelBack=(44769,0,10115)	GroupBox groupLungA,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupLungV,pos={757,65},size={128,30},labelBack=(62954,0,1022)	GroupBox groupLungV,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupSysV,pos={472,535},size={125,31},labelBack=(44769,0,10115)	GroupBox groupSysV,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupSysA,pos={749,534},size={137,33},labelBack=(62954,0,1022)	GroupBox groupSysA,font="Comic Sans MS",fSize=16,frame=0	GroupBox groupPerfusion,pos={600,492},size={149,122},title="Perfusion"	GroupBox groupPerfusion,font="Comic Sans MS",fSize=18	GroupBox groupUpperIVC2,pos={411,191},size={34,108},labelBack=(44769,0,10115)	GroupBox groupUpperIVC2,font="Comic Sans MS",fSize=16,frame=0	ValDisplay valdispECMOCO2flux,pos={623,398},size={107,14},title="CO2 elimination"	ValDisplay valdispECMOCO2flux,font="Comic Sans MS",fSize=9,format="%.0f"	ValDisplay valdispECMOCO2flux,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispECMOCO2flux,value= #"ECMOCO2flux"	ValDisplay valdispLUNGCO2flux,pos={625,106},size={107,14},title="CO2 elimination"	ValDisplay valdispLUNGCO2flux,font="Comic Sans MS",fSize=9,format="%.0f"	ValDisplay valdispLUNGCO2flux,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispLUNGCO2flux,value= #"LUNGCO2flux"	ValDisplay valdispPHsa,pos={903,464},size={47,22},fSize=16	ValDisplay valdispPHsa,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPHsa,value= #"round(phsa*100)/100"	ValDisplay valdispPCO2sa,pos={959,463},size={34,22},fSize=16	ValDisplay valdispPCO2sa,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPCO2sa,value= #"round(pco2sa)"	ValDisplay valdispPO2sa,pos={1000,463},size={44,22},fSize=16	ValDisplay valdispPO2sa,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPO2sa,value= #"round(syspo2)"	ValDisplay valdispPHsv,pos={317,444},size={47,22},fSize=16	ValDisplay valdispPHsv,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPHsv,value= #"round(phsv*100)/100"	ValDisplay valdispPCO2sv,pos={371,443},size={34,22},fSize=16	ValDisplay valdispPCO2sv,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPCO2sv,value= #"round(pco2sv)"	ValDisplay valdispPO2sv,pos={412,443},size={44,22},fSize=16	ValDisplay valdispPO2sv,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPO2sv,value= #"round(svpo2)"	ValDisplay valdispPHpa,pos={318,54},size={47,22},fSize=16	ValDisplay valdispPHpa,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPHpa,value= #"round(phpa*100)/100"	ValDisplay valdispPCO2pa,pos={372,53},size={34,22},fSize=16	ValDisplay valdispPCO2pa,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPCO2pa,value= #"round(pco2pa)"	ValDisplay valdispPO2pa,pos={413,53},size={44,22},fSize=16	ValDisplay valdispPO2pa,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPO2pa,value= #"round(PApo2)"	ValDisplay valdispPHpv,pos={902,42},size={47,22},fSize=16	ValDisplay valdispPHpv,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPHpv,value= #"round(phpv*100)/100"	ValDisplay valdispPCO2pv,pos={956,41},size={34,22},fSize=16	ValDisplay valdispPCO2pv,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPCO2pv,value= #"round(pco2pv)"	ValDisplay valdispPO2pv,pos={997,41},size={44,22},fSize=16	ValDisplay valdispPO2pv,limits={0,0,0},barmisc={0,1000},mode= 2	ValDisplay valdispPO2pv,value= #"round(po2pulmvein)"EndMacroWindow vq() : Panel	PauseUpdate; Silent 1		// building window...	NewPanel /W=(141,104,1233,683)	Slider sliderVentApex,pos={153,33},size={120,45},proc=SliderProcVentApex	Slider sliderVentApex,limits={0,10,0.5},variable= ventApex,side= 2,vert= 0,thumbColor= (65535,65533,32768)	Slider sliderBloodApex,pos={153,90},size={120,45},proc=SliderProcBloodapex	Slider sliderBloodApex,limits={0,10,0.5},variable= BloodApex,vert= 0	Slider sliderVentBase,pos={152,309},size={120,45},proc=SliderProcVentbase	Slider sliderVentBase,limits={0,5,0.5},variable= ventBase,side= 2,vert= 0,thumbColor= (65535,65533,32768)	Slider sliderBloodMiddle,pos={157,193},size={120,45},proc=SliderProcBloodmiddle	Slider sliderBloodMiddle,limits={0,5,0.5},variable= BloodMiddle,vert= 0	Slider sliderBloodBase,pos={159,374},size={120,45},proc=SliderProcBloodbase	Slider sliderBloodBase,limits={0,5,0.5},variable= BloodBase,vert= 0	GroupBox groupApex,pos={149,12},size={133,260},title="Lung",font="Comic Sans MS"	GroupBox groupApex,fSize=12	GroupBox groupBase,pos={149,293},size={132,139},title="ECMO"	GroupBox groupBase,font="Comic Sans MS",fSize=12	GroupBox groupMiddle,pos={155,171},size={124,74},title="Shunt"	GroupBox groupMiddle,font="Comic Sans MS",fSize=12	SetVariable setvarFIO2,pos={40,45},size={111,19},proc=SetVarProcFIO2,title="Lung FIO2"	SetVariable setvarFIO2,font="Comic Sans MS",fSize=12	SetVariable setvarFIO2,limits={0.01,1,0.01},value= FIO2	SetVariable setvarMVO2,pos={162,537},size={88,19},proc=SetVarProcSVO2,title="MVO2"	SetVariable setvarMVO2,font="Comic Sans MS",fSize=12	SetVariable setvarMVO2,limits={100,500,10},value= mvo2,live= 1	SetVariable setvarHb,pos={43,537},size={71,19},proc=SetVarProcHb,title="Hb"	SetVariable setvarHb,font="Comic Sans MS",fSize=12,limits={0,20,1},value= Hb	GroupBox groupApex1,pos={654,7},size={132,114},title="Lung",font="Comic Sans MS"	GroupBox groupApex1,fSize=12	GroupBox groupMiddle1,pos={658,131},size={132,114},title="Shunt"	GroupBox groupMiddle1,font="Comic Sans MS",fSize=12	GroupBox groupBase1,pos={661,260},size={132,114},title="ECMO"	GroupBox groupBase1,font="Comic Sans MS",fSize=12	ValDisplay valdispPO2Apex,pos={671,36},size={63,17},title="pO2"	ValDisplay valdispPO2Apex,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispPO2Apex,limits={0,0,0},barmisc={0,1000},value= #"PO2Apex"	ValDisplay valdispPO2Middle,pos={677,162},size={50,17},title="pO2"	ValDisplay valdispPO2Middle,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispPO2Middle,limits={0,0,0},barmisc={0,1000},value= #"PO2Middle"	ValDisplay valdispPO2Base,pos={686,290},size={62,17},title="pO2"	ValDisplay valdispPO2Base,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispPO2Base,limits={0,0,0},barmisc={0,1000},value= #"PO2Base"	ValDisplay valdispSatBase,pos={680,320},size={62,17},title="Sat"	ValDisplay valdispSatBase,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispSatBase,limits={0,0,0},barmisc={0,1000},value= #"SatBase"	ValDisplay valdispSatMiddle,pos={676,188},size={50,17},title="Sat"	ValDisplay valdispSatMiddle,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispSatMiddle,limits={0,0,0},barmisc={0,1000},value= #"SatMiddle"	ValDisplay valdispSatApex,pos={672,68},size={58,17},title="Sat"	ValDisplay valdispSatApex,font="Comic Sans MS",fSize=12,format="%.0f"	ValDisplay valdispSatApex,limits={0,0,0},barmisc={0,1000},value= #"SatApex"	GroupBox groupPulmVein,pos={802,67},size={130,100},title="Pulm Vein"	GroupBox groupPulmVein,labelBack=(47446,5656,9578),font="Comic Sans MS",fSize=16	ValDisplay valdispPulmVeinPO2,pos={823,98},size={76,24},title="pO2"	ValDisplay valdispPulmVeinPO2,font="Comic Sans MS",fSize=16,format="%0.f"	ValDisplay valdispPulmVeinPO2,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispPulmVeinPO2,value= #"pO2PulmVein"	ValDisplay valdispPulmVeinSat,pos={829,133},size={68,24},title="Sat"	ValDisplay valdispPulmVeinSat,font="Comic Sans MS",fSize=16,format="%0.f"	ValDisplay valdispPulmVeinSat,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispPulmVeinSat,value= #"SatPulmVein"	ValDisplay valdispCalcSVO2,pos={36,160},size={96,13},title="PA sat"	ValDisplay valdispCalcSVO2,format="%0.f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCalcSVO2,value= #"PAsat"	SetVariable setvarECMOFIO2,pos={26,327},size={123,19},proc=SetVarProcFIO2,title="ECMO FIO2"	SetVariable setvarECMOFIO2,font="Comic Sans MS",fSize=12	SetVariable setvarECMOFIO2,limits={0.01,1,0.01},value= ECMOFIO2	GroupBox groupSystemArt,pos={942,67},size={130,100},title="Systemic"	GroupBox groupSystemArt,labelBack=(65238,0,0),font="Comic Sans MS",fSize=16	ValDisplay valdispSystemicPO2,pos={960,104},size={76,24},title="pO2"	ValDisplay valdispSystemicPO2,font="Comic Sans MS",fSize=16,format="%0.f"	ValDisplay valdispSystemicPO2,limits={0,0,0},barmisc={0,1000},value= #"SysPO2"	ValDisplay valdispSystemicSat,pos={965,135},size={66,24},title="Sat"	ValDisplay valdispSystemicSat,font="Comic Sans MS",fSize=16,format="%0.f"	ValDisplay valdispSystemicSat,limits={0,0,0},barmisc={0,1000},value= #"SysSat"	SetVariable setvarPercentBlend,pos={162,443},size={108,19},proc=SetVarProcBlendECMOprecent,title="Percent V"	SetVariable setvarPercentBlend,font="Comic Sans MS",fSize=12	SetVariable setvarPercentBlend,limits={0,100,1},value= PercentVforblendedECMO,live= 1	ValDisplay valdisptotalflow,pos={962,208},size={96,13},title="Total Flow"	ValDisplay valdisptotalflow,format="%.1f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdisptotalflow,value= #"totalflow"	ValDisplay valdispCalcSVO4,pos={1594,264},size={96,13},title="PA sat"	ValDisplay valdispCalcSVO4,format="%0.f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCalcSVO4,value= #"PAsat"	ValDisplay valdispCO,pos={814,209},size={96,13},title="CO",format="%.1f"	ValDisplay valdispCO,limits={0,0,0},barmisc={0,1000},value= #"heartflow"	ValDisplay valdispSVO2,pos={891,25},size={96,20},title="SVO2",fSize=14	ValDisplay valdispSVO2,format="%.0f",limits={0,0,0},barmisc={0,1000}	ValDisplay valdispSVO2,value= #"SVO2"	Display/W=(291,24,629,484)/HOST=#  artery,vein,alveoli,alveoli2 vs Position	ModifyGraph margin(left)=89,width=360,height=280,gbRGB=(65535,61210,59645)	ModifyGraph marker(alveoli)=19	ModifyGraph rgb(alveoli)=(52428,52425,1),rgb(alveoli2)=(52428,52425,1)	ModifyGraph msize(alveoli)=20	ModifyGraph toMode(artery)=-1,toMode(alveoli)=1,toMode(alveoli2)=-1	ModifyGraph useMrkStrokeRGB(alveoli)=1	ModifyGraph zmrkSize(alveoli)={alveolisize,0,1,1,6}	ModifyGraph zColor(artery)={arterycolor,0,50,BlueRedGreen256},zColor(vein)={veincolor,0,50,BlueRedGreen256}	ModifyGraph grid(bottom)=1	ModifyGraph noLabel(left)=2	ModifyGraph lblMargin(left)=63	ModifyGraph lblLatPos(left)=-2	ModifyGraph lblRot(bottom)=-90	ModifyGraph tkLblRot(bottom)=90	Label left "\\F'Comic Sans MS'\\Z12Liters/minute"	SetAxis left -10,10	TextBox/C/N=text2/F=0/A=MB/X=-0.71/Y=-9.17 "\\F'Comic Sans MS'\\Z12Flow (Liters/minute)"	Legend/C/N=text3/J/F=0/A=MB/X=0.71/Y=-23.33 "\\F'Comic Sans MS'\\Z12\\s(alveoli) Ventilation\r\\s(artery) Perfusion"	ModifyGraph swapXY=1	RenameWindow #,G0	SetActiveSubwindow ##EndMacroFunction ECMOflux(flow,deltaP)	variable flow,deltaP	variable maxflux	wave coef=W_coefQuadrox		maxflux= poly(coef,flow)	return (maxflux*deltaP/760)		End	